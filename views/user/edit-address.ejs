<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BookSy - Your Favorite Bookstore</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
       .page-gradient-bg {
        background: linear-gradient(135deg, #f3e7d3 0%, #e6d7c3 25%, #d9c7b3 50%, #e6d7c3 75%, #f3e7d3 100%);
    }
    .book-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    .hero-section {
      background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('/api/placeholder/1200/400');
      background-size: cover;
      background-position: center;
    }
     /* Animation keyframes */
  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  @keyframes floatBook {
    0% { transform: translateY(0) rotate(0deg); }
    50% { transform: translateY(-10px) rotate(3deg); }
    100% { transform: translateY(0) rotate(0deg); }
  }
  
  /* Applied animations */
  .animate-fadeInUp {
    animation: fadeInUp 1s ease-out forwards;
  }
  
  .animate-float {
    animation: floatBook 3s ease-in-out infinite;
  }
  
  /* Book styling */
  .book-cover {
    height: 220px;
    width: 150px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    transition: transform 0.3s ease;
    border-radius: 4px;
    overflow: hidden;
  }
  
  .book-cover:hover {
    transform: translateY(-10px) scale(1.05);
  }
  
  /* Active slide */
  .hero-slide.active {
    opacity: 1;
    z-index: 10;
  }
  
  /* Active indicator */
  .slide-indicator.active {
    opacity: 1;
    width: 24px;
  }
  @keyframes gradient-shift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  
  .animate-gradient-shift {
    background-size: 200% 200%;
    animation: gradient-shift 10s ease infinite;
  }
  </style>
</head>
<body class="bg-gray-50">

<!-- Navbar (shared partial) -->
<%- include('../partials/navbar') %>

  <div class="container mx-auto px-4 py-8">
    <div class="max-w-md mx-auto">
        <div class="flex items-center mb-6">
            <a href="<%= locals.fromCheckout ? '/checkout' : '/addresses' %>" class="text-blue-600 hover:text-blue-800 mr-2">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
                </svg>
            </a>
            <!-- Fixed the title logic to use req.params.id instead of checking address -->
            <h1 class="text-2xl font-bold"><%= locals.title %></h1>
        </div>
        
        <% if (locals.error) { %>
            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                <%= error %>
            </div>
        <% } %>
        
        <div class="bg-white shadow-md rounded-lg p-6">
          <!-- Fixed the form action to preserve the original ID -->
          <form action="<%= locals.fromCheckout ? `/checkout/edit-address/${addressId}` : `/edit-address/${addressId}` %><%= locals.fromCheckout ? '?checkout=true' : '' %>" method="POST">            <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Full Name*</label>
                    <input type="text" id="name" name="name" value="<%= address ? address.name : '' %>" 
                        class="w-full px-3 py-2 border <%= locals.errors && errors.name ? 'border-red-500' : 'border-gray-300' %> rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    <% if (locals.errors && errors.name) { %>
                        <p class="mt-1 text-xs text-red-600"><%= errors.name %></p>
                    <% } %>
                </div>
    
    <div class="mb-4">
        <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number*</label>
        <input type="tel" id="phone" name="phone" value="<%= address ? address.phone : '' %>" 
               class="w-full px-3 py-2 border <%= locals.errors && errors.phone ? 'border-red-500' : 'border-gray-300' %> rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
        <% if (locals.errors && errors.phone) { %>
            <p class="mt-1 text-xs text-red-600"><%= errors.phone %></p>
        <% } %>
    </div>
    
    <div class="mb-4">
        <label for="addressLine1" class="block text-sm font-medium text-gray-700 mb-1">Address Line 1*</label>
        <input type="text" id="addressLine1" name="addressLine1" value="<%= address ? address.addressLine1 : '' %>" 
               class="w-full px-3 py-2 border <%= locals.errors && errors.addressLine1 ? 'border-red-500' : 'border-gray-300' %> rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
        <% if (locals.errors && errors.addressLine1) { %>
            <p class="mt-1 text-xs text-red-600"><%= errors.addressLine1 %></p>
        <% } %>
    </div>
    
    <div class="mb-4">
        <label for="addressLine2" class="block text-sm font-medium text-gray-700 mb-1">Address Line 2</label>
        <input type="text" id="addressLine2" name="addressLine2" value="<%= address ? address.addressLine2 : '' %>" 
               class="w-full px-3 py-2 border <%= locals.errors && errors.addressLine2 ? 'border-red-500' : 'border-gray-300' %> rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
        <% if (locals.errors && errors.addressLine2) { %>
            <p class="mt-1 text-xs text-red-600"><%= errors.addressLine2 %></p>
        <% } %>
    </div>
    
    <div class="mb-4">
        <label for="city" class="block text-sm font-medium text-gray-700 mb-1">City*</label>
        <input type="text" id="city" name="city" value="<%= address ? address.city : '' %>" 
               class="w-full px-3 py-2 border <%= locals.errors && errors.city ? 'border-red-500' : 'border-gray-300' %> rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
        <% if (locals.errors && errors.city) { %>
            <p class="mt-1 text-xs text-red-600"><%= errors.city %></p>
        <% } %>
    </div>
    
    <div class="grid grid-cols-2 gap-4 mb-4">
        <div>
            <label for="state" class="block text-sm font-medium text-gray-700 mb-1">State*</label>
            <input type="text" id="state" name="state" value="<%= address ? address.state : '' %>" 
                   class="w-full px-3 py-2 border <%= locals.errors && errors.state ? 'border-red-500' : 'border-gray-300' %> rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
            <% if (locals.errors && errors.state) { %>
                <p class="mt-1 text-xs text-red-600"><%= errors.state %></p>
            <% } %>
        </div>
        <div>
            <label for="postalCode" class="block text-sm font-medium text-gray-700 mb-1">Postal Code*</label>
            <input type="text" id="postalCode" name="postalCode" value="<%= address ? address.postalCode : '' %>" 
                   class="w-full px-3 py-2 border <%= locals.errors && errors.postalCode ? 'border-red-500' : 'border-gray-300' %> rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
            <% if (locals.errors && errors.postalCode) { %>
                <p class="mt-1 text-xs text-red-600"><%= errors.postalCode %></p>
            <% } %>
        </div>
    </div>
    
    <div class="mb-6">
        <label for="country" class="block text-sm font-medium text-gray-700 mb-1">Country*</label>
        <select id="country" name="country" 
                class="w-full px-3 py-2 border <%= locals.errors && errors.country ? 'border-red-500' : 'border-gray-300' %> rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
            <option value="">Select a country</option>
            <% 
            const countries = [
                'Afghanistan', 'Albania', 'Algeria', 'Andorra', 'Angola', 'Antigua and Barbuda', 'Argentina', 'Armenia', 'Australia', 
                'Austria', 'Azerbaijan', 'Bahamas', 'Bahrain', 'Bangladesh', 'Barbados', 'Belarus', 'Belgium', 'Belize', 'Benin', 
                'Bhutan', 'Bolivia', 'Bosnia and Herzegovina', 'Botswana', 'Brazil', 'Brunei', 'Bulgaria', 'Burkina Faso', 'Burundi', 
                'Cabo Verde', 'Cambodia', 'Cameroon', 'Canada', 'Central African Republic', 'Chad', 'Chile', 'China', 'Colombia', 
                'Comoros', 'Congo', 'Costa Rica', 'Croatia', 'Cuba', 'Cyprus', 'Czech Republic', 'Denmark', 'Djibouti', 'Dominica', 
                'Dominican Republic', 'Ecuador', 'Egypt', 'El Salvador', 'Equatorial Guinea', 'Eritrea', 'Estonia', 'Eswatini', 
                'Ethiopia', 'Fiji', 'Finland', 'France', 'Gabon', 'Gambia', 'Georgia', 'Germany', 'Ghana', 'Greece', 'Grenada', 
                'Guatemala', 'Guinea', 'Guinea-Bissau', 'Guyana', 'Haiti', 'Honduras', 'Hungary', 'Iceland', 'India', 'Indonesia', 
                'Iran', 'Iraq', 'Ireland', 'Israel', 'Italy', 'Jamaica', 'Japan', 'Jordan', 'Kazakhstan', 'Kenya', 'Kiribati', 
                'Korea, North', 'Korea, South', 'Kosovo', 'Kuwait', 'Kyrgyzstan', 'Laos', 'Latvia', 'Lebanon', 'Lesotho', 'Liberia', 
                'Libya', 'Liechtenstein', 'Lithuania', 'Luxembourg', 'Madagascar', 'Malawi', 'Malaysia', 'Maldives', 'Mali', 'Malta', 
                'Marshall Islands', 'Mauritania', 'Mauritius', 'Mexico', 'Micronesia', 'Moldova', 'Monaco', 'Mongolia', 'Montenegro', 
                'Morocco', 'Mozambique', 'Myanmar', 'Namibia', 'Nauru', 'Nepal', 'Netherlands', 'New Zealand', 'Nicaragua', 'Niger', 
                'Nigeria', 'North Macedonia', 'Norway', 'Oman', 'Pakistan', 'Palau', 'Palestine', 'Panama', 'Papua New Guinea', 
                'Paraguay', 'Peru', 'Philippines', 'Poland', 'Portugal', 'Qatar', 'Romania', 'Russia', 'Rwanda', 'Saint Kitts and Nevis', 
                'Saint Lucia', 'Saint Vincent and the Grenadines', 'Samoa', 'San Marino', 'Sao Tome and Principe', 'Saudi Arabia', 
                'Senegal', 'Serbia', 'Seychelles', 'Sierra Leone', 'Singapore', 'Slovakia', 'Slovenia', 'Solomon Islands', 'Somalia', 
                'South Africa', 'South Sudan', 'Spain', 'Sri Lanka', 'Sudan', 'Suriname', 'Sweden', 'Switzerland', 'Syria', 'Taiwan', 
                'Tajikistan', 'Tanzania', 'Thailand', 'Timor-Leste', 'Togo', 'Tonga', 'Trinidad and Tobago', 'Tunisia', 'Turkey', 
                'Turkmenistan', 'Tuvalu', 'Uganda', 'Ukraine', 'United Arab Emirates', 'United Kingdom', 'United States', 'Uruguay', 
                'Uzbekistan', 'Vanuatu', 'Vatican City', 'Venezuela', 'Vietnam', 'Yemen', 'Zambia', 'Zimbabwe'
            ];
            
            const selectedCountry = address ? address.country : 'India';
            
            countries.forEach(country => {
                const selected = country === selectedCountry ? 'selected' : '';
            %>
                <option value="<%= country %>" <%= selected %>><%= country %></option>
            <% }); %>
        </select>
        <% if (locals.errors && errors.country) { %>
            <p class="mt-1 text-xs text-red-600"><%= errors.country %></p>
        <% } %>
    </div>
    
    <div class="mb-6">
        <label class="flex items-center">
            <input type="checkbox" name="isDefault" <%= address && address.isDefault ? 'checked' : '' %> class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
            <span class="ml-2 text-sm text-gray-700">Make this my default address</span>
        </label>
    </div>
    
    <div class="flex justify-between">
        <a href="<%= locals.fromCheckout ? '/checkout' : '/addresses' %>" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50">Cancel</a>        <button type="submit" class="px-4 py-2 bg-blue-600 border border-transparent rounded-md font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Save Address</button>
    </div>
</form>
        </div>
    </div>
</div>

  <%- include('../partials/footer') %>